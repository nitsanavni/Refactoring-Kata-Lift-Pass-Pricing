name: Bun

on:
    push:

jobs:
    coverage:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Install Bun
              run: |
                  curl -fsSL https://bun.sh/install | bash
                  echo "${HOME}/.bun/bin" >> $GITHUB_PATH

            - name: mysql
              run: |
                  ./runLocalDatabase.sh
                  (timeout 10 docker logs -f mariadb 2>&1 &) | grep -m 1 'ready for connections'

            - name: run tests
              working-directory: typescript-bun
              run: bun test
